:PROPERTIES:
:ID:       c8170642-ba6a-4925-8aab-0c325383171c
:mtime:    20251222225802 20251222070634
:ctime:    20251222070634
:END:
#+TITLE: Git Cleaning
#+FILETAGS: :git:cleaning:secrets:

Various tools and approaches to cleaning a repositories history. These can be used to removes items from the Git history
if for example you have mistakenly included secrets or large files.

* Finding Large Files

A neat solution on [[https://stackoverflow.com/a/42544963/1444043][StackOverflow]] shows how to list all blobs in a repository sorted by size.

#+begin_example
# Source - https://stackoverflow.com/a/42544963
# Posted by raphinesse, modified by community. See post 'Timeline' for change history
# Retrieved 2025-12-22, License - CC BY-SA 4.0

git rev-list --objects --all --missing=print |
  git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' |
  sed -n 's/^blob //p' |
  sort --numeric-sort --key=2 |
  cut -c 1-12,41- |
  $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest
#+end_example

** Filtering

It goes on to show how you can filter the output either to exclude files that are in ~HEAD~

#+begin_example
# Source - https://stackoverflow.com/a/42544963
# Posted by raphinesse, modified by community. See post 'Timeline' for change history
# Retrieved 2025-12-22, License - CC BY-SA 4.0

grep -vF --file=<(git ls-tree -r HEAD | awk '{print $3}') |

#+end_example

...or by a given size...

#+begin_example
# Source - https://stackoverflow.com/a/42544963
# Posted by raphinesse, modified by community. See post 'Timeline' for change history
# Retrieved 2025-12-22, License - CC BY-SA 4.0

awk '$2 >= 2^20' |

#+end_example

* Links

+ [[https://www.lullabot.com/articles/how-calculate-git-repository-growth-over-time][How to Calculate Git Repository Growth Over Time | Lullabot]]
+ [[https://github.com/github/git-sizer][git-sizer]]
+ [[https://rtyley.github.io/bfg-repo-cleaner/][BFG Repo-Cleaner]]
